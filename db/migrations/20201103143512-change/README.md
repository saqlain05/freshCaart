# Migration `20201103143512-change`

This migration has been generated by ykn88 at 11/3/2020, 8:05:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "User" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "name" TEXT,
    "email" TEXT NOT NULL,
    "hashedPassword" TEXT,
    "role" TEXT NOT NULL DEFAULT 'user',
    "verified" BOOLEAN NOT NULL DEFAULT false
)

CREATE TABLE "Session" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "expiresAt" DATETIME,
    "handle" TEXT NOT NULL,
    "userId" INTEGER,
    "hashedSessionToken" TEXT,
    "antiCSRFToken" TEXT,
    "publicData" TEXT,
    "privateData" TEXT,

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "Profile" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "firstName" TEXT NOT NULL,
    "lastName" TEXT NOT NULL,
    "shopName" TEXT NOT NULL,
    "phone" TEXT NOT NULL,
    "whatsapp" TEXT NOT NULL,
    "address" TEXT NOT NULL,
    "city" TEXT NOT NULL,
    "pincode" TEXT NOT NULL,
    "openTime" TEXT NOT NULL,
    "closeTime" TEXT NOT NULL,
    "maxOrderAcceptTime" TEXT NOT NULL,
    "longitude" TEXT,
    "latitude" TEXT,
    "userId" INTEGER,

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
)

CREATE TABLE "Category" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "name" TEXT NOT NULL
)

CREATE TABLE "Product" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "name" TEXT NOT NULL,
    "price" REAL NOT NULL,
    "imageUrl" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "minQuantity" INTEGER NOT NULL,
    "stock" BOOLEAN NOT NULL,
    "measureUnit" TEXT NOT NULL,
    "categoryId" INTEGER NOT NULL,

    FOREIGN KEY ("categoryId") REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Cart" (
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "quantity" REAL,
    "productId" INTEGER NOT NULL,
    "productPrice" REAL,
    "userId" INTEGER NOT NULL,

    FOREIGN KEY ("productId") REFERENCES "Product"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    PRIMARY KEY ("userId","productId")
)

CREATE TABLE "Order" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "phone" TEXT,
    "address" TEXT,
    "pinCode" TEXT,
    "city" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,
    "totalPrice" REAL,
    "payMode" TEXT,
    "payStatus" TEXT DEFAULT 'PENDING',
    "orderStatus" TEXT DEFAULT 'NULL',

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "OrderDetail" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "quantity" REAL NOT NULL,
    "orderId" INTEGER NOT NULL,
    "goodsId" INTEGER,
    "productPrice" REAL NOT NULL,

    FOREIGN KEY ("orderId") REFERENCES "Order"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "TopSellingItem" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "itemName" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "Session.handle_unique" ON "Session"("handle")

CREATE UNIQUE INDEX "Profile_userId_unique" ON "Profile"("userId")

CREATE UNIQUE INDEX "Cart_userId_unique" ON "Cart"("userId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201103111845-initial-migration..20201103143512-change
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -20,8 +20,13 @@
   email          String    @unique
   hashedPassword String?
   role           String    @default("user")
   sessions       Session[]
+  profile        Profile?
+  cart           Cart?
+  orders         Order[]
+  topItems       TopSellingItem[]
+  verified       Boolean   @default(false)
 }
 model Session {
   id                 Int       @default(autoincrement()) @id
@@ -35,4 +40,98 @@
   antiCSRFToken      String?
   publicData         String?
   privateData        String?
 }
+
+model Profile {
+  id              Int      @default(autoincrement()) @id
+  createdAt       DateTime @default(now())
+  updatedAt       DateTime @updatedAt
+  firstName       String   
+  lastName        String   
+  shopName        String   
+  phone           String      
+  whatsapp        String      
+  address         String   
+  city            String   
+  pincode         String      
+  openTime        String   
+  closeTime       String   
+  maxOrderAcceptTime String   
+  longitude       String?   
+  latitude        String?   
+  user            User?   @relation(fields: [userId], references: [id]) 
+  userId          Int?    
+}
+
+model Category {
+  id        Int       @default(autoincrement()) @id
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  name      String    
+  product   Product[] 
+}
+
+model Product {
+  id          Int      @default(autoincrement()) @id
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+  name        String   
+  price       Float    
+  imageUrl    String   
+  description String   
+  minQuantity Int      
+  stock       Boolean  
+  measureUnit String   
+  category    Category @relation(fields: [categoryId], references: [id])
+  categoryId  Int  
+  cart        Cart[]    
+}
+
+model Cart {
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  quantity  Float?    
+  product   Product  @relation(fields: [productId], references: [id])
+  productId Int
+  productPrice Float?      
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int
+  @@id([userId, productId])      
+}
+
+model Order {
+  id           Int           @default(autoincrement()) @id
+  createdAt    DateTime      @default(now())
+  updatedAt    DateTime      @updatedAt
+  phone        String?        
+  address      String?        
+  pinCode      String? 
+  city         String       
+  user         User          @relation(fields: [userId], references: [id])
+  userId       Int           
+  orderDetails OrderDetail[] 
+  totalPrice   Float?
+  payMode      String?
+  payStatus    String?       @default("PENDING")       
+  orderStatus  String?        @default("NULL")       
+}
+
+model OrderDetail {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  quantity  Float    
+  order     Order    @relation(fields: [orderId], references: [id])
+  orderId   Int
+  goodsId   Int?
+  productPrice Float    
+}
+
+model TopSellingItem {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  itemName  String   
+  user      User     @relation(fields: [userId], references: [id])
+  userId    Int      
+}
```


